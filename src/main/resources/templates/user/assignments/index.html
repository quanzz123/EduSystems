<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bài tập của tôi</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <link rel="stylesheet"
          href="https://cdn.lineicons.com/4.0/lineicons.css">
</head>

<body>

<section class="assignments-section py-5">

    <!-- NÚT QUAY LẠI -->
    <div class="container mb-4">
        <a href="javascript:history.back()" class="btn btn-back">
            <i class="lni lni-arrow-left me-1"></i> Quay lại
        </a>
    </div>

    <div class="container">

        <!-- HEADER -->
        <div class="mb-4">
            <h2 class="fw-bold">
                <i class="lni lni-pencil-alt text-primary me-2"></i>
                Bài tập của tôi
            </h2>
            <p class="text-muted">
                Xin chào
                <strong th:text="${currentUser.fullname}">Sinh viên</strong>
            </p>
        </div>

        <!-- DANH SÁCH BÀI TẬP -->
        <div class="row g-4">

            <div class="col-lg-6"
                 th:each="a : ${assignments}">

                <div class="assignment-card">

                    <!-- HEADER -->
                    <div class="assignment-header">
                        <span class="badge bg-light text-primary">
                            <i class="lni lni-book me-1"></i>
                            <span th:text="${a.clas != null ? a.clas.classname : 'Không rõ lớp'}">
                                Tên lớp
                            </span>
                        </span>

                        <span class="deadline"
                              th:text="${a.deadline != null ? #dates.format(a.deadline,'dd/MM/yyyy') : 'Chưa có hạn'}">                            20/06/20
                        </span>
                    </div>

                    <!-- BODY -->
                    <div class="assignment-body">
                        <h5 th:text="${a.title}">Tên bài tập</h5>
                        <p th:text="${a.description}">Mô tả bài tập</p>
                    </div>

                    <!-- FOOTER -->
                    <div class="assignment-footer">
                        <span class="status"
                            th:classappend="${a.deadline != null and a.deadline.before(#dates.createNow())} ? 'late' : 'open'">
                            <span th:text="${a.deadline != null and a.deadline.before(#dates.createNow()) ? 'Quá hạn' : 'Đang mở'}">
                                Đang mở
                            </span>
                        </span>

                        <!-- Nút mở form nộp bài -->
                        <button class="btn btn-sm btn-primary" type="button" 
                                data-bs-toggle="collapse" 
                                th:data-bs-target="'#submitForm' + ${a.assignmentid}">
                            <i class="lni lni-upload me-1"></i> Nộp bài
                        </button>
                    </div>

                    <!-- Form nộp bài (ẩn, collapse) -->
                    <div class="collapse mt-3" th:id="'submitForm' + ${a.assignmentid}">
                        <form th:action="@{/user/assignments/{id}/submit(id=${a.assignmentid})}" 
                            method="post" enctype="multipart/form-data">
                            <div class="input-group">
                                <input type="file" name="file" class="form-control" required>
                                <button type="submit" class="btn btn-success">Gửi</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- TRƯỜNG HỢP RỖNG -->
            <div class="col-12"
                 th:if="${assignments == null or #lists.isEmpty(assignments)}">
                <div class="empty-box text-center">
                    <i class="lni lni-empty-file"></i>
                    <p>Chưa có bài tập nào</p>
                </div>
            </div>

        </div>
    </div>
</section>

<style>
.assignments-section {
    background: linear-gradient(180deg,#f8f9ff,#fff);
    min-height: 100vh;
}

.btn-back {
    border-radius: 999px;
    border: 2px solid #e2e8f0;
    padding: 8px 18px;
    font-weight: 600;
}

.assignment-card {
    background: #fff;
    border-radius: 18px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,.08);
    transition: .3s;
}
.assignment-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 20px 40px rgba(0,0,0,.15);
}

.assignment-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
}

.deadline {
    font-size: .85rem;
    color: #64748b;
}

.assignment-body h5 {
    font-weight: 700;
    margin-bottom: 6px;
}
.assignment-body p {
    font-size: .9rem;
    color: #64748b;
}

.assignment-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 14px;
}

.status {
    padding: 4px 12px;
    border-radius: 999px;
    font-size: .75rem;
    font-weight: 700;
}
.status.open { background: #e0e7ff; color: #4338ca; }
.status.late { background: #fee2e2; color: #991b1b; }

.empty-box {
    padding: 60px;
    border-radius: 18px;
    background: #f8fafc;
    color: #64748b;
}
.empty-box i {
    font-size: 3rem;
    margin-bottom: 10px;
}
</style>

</body>
</html>
